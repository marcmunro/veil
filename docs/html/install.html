<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Veil: Installation and Configuration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Veil
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('install.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Installation and Configuration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="install_sec"></a>
Installation</h1>
<h2><a class="anchor" id="Get"></a>
Getting Veil</h2>
<p>Veil can be downloaded as a gzipped tarball from <a href="http://pgfoundry.org/projects/veil/">http://pgfoundry.org/projects/veil/</a></p>
<p>Since version 9.1, git is no longer available from cvs on pgfoundry. Development has switched to using git. The primary git repository is git://github.com/marcmunro/veil.git</p>
<p>To checkout from git, create a suitable directory and do:</p>
<pre class="fragment"> git clone git://github.com/marcmunro/veil.git
</pre><p>Alternative repositories are also available: </p><pre class="fragment"> git clone git://bloodnok.com/veil
</pre><p>or </p><pre class="fragment"> git clone git@github.com:marcmunro/veil.git
</pre><h2><a class="anchor" id="Pre-requisites"></a>
Pre-requisites</h2>
<p>You must have a copy of the Postgresql header files available in order to build Veil. For this, you may need to install the postgres developer packages for your OS, or even build postgres from source. </p>
<h2><a class="anchor" id="build-sub"></a>
Building Veil</h2>
<p>Veil is built using the postgresql extension building infastructure, PGXS. In order to be able to build using PGXS, the following command must return the location of the PGXS makefile: </p><pre class="fragment">$ pg_config --pgxs
</pre><p> You may need to modify your PATH variable to make pg_config usable, or ensure it is for the correct postgresql version.</p>
<p>To build the postgres extensions, simply run make with no target: </p><pre class="fragment">$ make
</pre><p>As part of figuring our the configuration, the makefile will attempt to work out which version of Postgres to build for. If it fails to figure this out, add PG_VERSION=&lt;x.y&gt; to the make command. eg:</p>
<pre class="fragment">$ make PG_VERSION="9.4"
</pre><p>To build the veil documentation (the documentation you are now reading) use:</p>
<pre class="fragment">$ make docs
</pre><p>Note that the build system deliberately avoids using make recursively. Search the Web for "Recursive Make Considered Harmful" for the reasons why. This makes the construction of the build system a little different from what you may be used to. This may or may not turn out to be a good thing. <a class="el" href="Feedback.html#Feedback">Feedback</a> is welcomed.</p>
<h2><a class="anchor" id="Install"></a>
Installing Veil</h2>
<p>As the postgres, pgsql, or root user, run <code>make install</code>. </p><pre class="fragment">make install
</pre><h1><a class="anchor" id="configuration"></a>
Configuration</h1>
<p>To configure Veil, the following lines should be added to your postgresql.conf: </p><div class="fragment"><div class="line">shared_preload_libraries = <span class="stringliteral">&#39;&lt;path to shared library&gt;/veil.so&#39;</span> </div><div class="line"></div><div class="line"><span class="preprocessor">#veil.dbs_in_cluster = 1</span></div><div class="line"><span class="preprocessor">#veil.shared_hash_elems = 32</span></div><div class="line"><span class="preprocessor">#veil.shmem_context_size = 16384</span></div></div><!-- fragment --><p>The three configuration options, commented out above, are:</p><ul>
<li>dbs_in_cluster The number of databases, within the database cluster, that will use Veil. Each such database will be allocated 2 chunks of shared memory (of shmem_context_size), and a single LWLock. It defaults to 1.</li>
<li>shared_hash_elems This describes how large a hash table should be created for veil shared variables. It defaults to 32. If you have more than about 20 shared variables you may want to increase this to improve performance. This setting does not limit the number of variables that may be defined, it just limits how efficiently they may be accessed.</li>
<li>shmem_context_size This sets an upper limit on the amount of shared memory for a single Veil shared memory context (there will be two of these). It defaults to 16K. Increase this if you have many shared memory structures.</li>
</ul>
<h2><a class="anchor" id="Regression"></a>
Regression Tests</h2>
<p>Veil comes with a built-in regression test suite. Use <code>make regress</code> or <code>make check</code> (after installing and configuring Veil) to run this. You will need superuser access to Postgres in order to create the regression test database. The regression test assumes you will have a postgres superuser account named the same as your OS account. If pg_hba.conf disallows "trust"ed access locally, then you will need to provide a password for this account in your .pgpass file (see postgres documentation for details).</p>
<p>The regression tests are all contained within the regress directory and are run by the regress.sh shell script. Use the -h option to get fairly detailed help.</p>
<h2><a class="anchor" id="Debugging"></a>
Debugging</h2>
<p>If you encounter problems with Veil, you may want to try building with debug enabled. Define the variable VEIL_DEBUG on the make command line to add extra debug code to the executable: </p><pre class="fragment">$ make clean; make VEIL_DEBUG=1 all
</pre><p>This is a transient feature and not as pervasive as it could be. If you need help with debugging please contact the author.</p>
<p>Next: <a class="el" href="History.html">History and Compatibility</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Veil</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
