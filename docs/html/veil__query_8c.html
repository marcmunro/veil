<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Veil: src/veil_query.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Veil
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('veil__query_8c.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">veil_query.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Functions to simplify SPI-based queries. These are way more sophisticated than veil really needs but are nice and generic.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br />
<code>#include &quot;postgres.h&quot;</code><br />
<code>#include &quot;catalog/pg_type.h&quot;</code><br />
<code>#include &quot;executor/spi.h&quot;</code><br />
<code>#include &quot;<a class="el" href="veil__version_8h_source.html">veil_version.h</a>&quot;</code><br />
<code>#include &quot;access/xact.h&quot;</code><br />
<code>#include &quot;<a class="el" href="veil__funcs_8h_source.html">veil_funcs.h</a>&quot;</code><br />
</div>
<p><a href="veil__query_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:aee051ef9b680e2c4efe31e40175ac4ea"><td class="memItemLeft" align="right" valign="top"><a id="aee051ef9b680e2c4efe31e40175ac4ea"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#aee051ef9b680e2c4efe31e40175ac4ea">FETCH_SIZE</a>&#160;&#160;&#160;20</td></tr>
<tr class="memdesc:aee051ef9b680e2c4efe31e40175ac4ea"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of records to fetch in one go from the query executor. <br /></td></tr>
<tr class="separator:aee051ef9b680e2c4efe31e40175ac4ea"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a42368367f5a1eef750ff948f44890274"><td class="memItemLeft" align="right" valign="top"><a id="a42368367f5a1eef750ff948f44890274"></a>
typedef bool()&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274">Fetch_fn</a>(HeapTuple, TupleDesc, void *)</td></tr>
<tr class="memdesc:a42368367f5a1eef750ff948f44890274"><td class="mdescLeft">&#160;</td><td class="mdescRight">A Fetch_fn is a function that processes records, one at a time, returned from a query. <br /></td></tr>
<tr class="separator:a42368367f5a1eef750ff948f44890274"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a96037051f6607912be91e02a1a7326e1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a96037051f6607912be91e02a1a7326e1">vl_spi_connect</a> (bool *p_pushed)</td></tr>
<tr class="memdesc:a96037051f6607912be91e02a1a7326e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">If already connected in this session, push the current connection, and get a new one.  <a href="#a96037051f6607912be91e02a1a7326e1">More...</a><br /></td></tr>
<tr class="separator:a96037051f6607912be91e02a1a7326e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade116109004c70d1eb5e049b09b8f9a9"><td class="memItemLeft" align="right" valign="top"><a id="ade116109004c70d1eb5e049b09b8f9a9"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#ade116109004c70d1eb5e049b09b8f9a9">vl_spi_finish</a> (bool pushed)</td></tr>
<tr class="memdesc:ade116109004c70d1eb5e049b09b8f9a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reciprocal function for <a class="el" href="veil__query_8c.html#a96037051f6607912be91e02a1a7326e1" title="If already connected in this session, push the current connection, and get a new one. ">vl_spi_connect()</a> <br /></td></tr>
<tr class="separator:ade116109004c70d1eb5e049b09b8f9a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a149deb729a4822a1d84ce21fba1fdf04"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a149deb729a4822a1d84ce21fba1fdf04">prepare_query</a> (const char *qry, int nargs, Oid *argtypes, Datum *args, bool read_only, void **saved_plan)</td></tr>
<tr class="memdesc:a149deb729a4822a1d84ce21fba1fdf04"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare a query for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query()</a>.  <a href="#a149deb729a4822a1d84ce21fba1fdf04">More...</a><br /></td></tr>
<tr class="separator:a149deb729a4822a1d84ce21fba1fdf04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a44d4a5e2cad01992bcc04ef319d1fef0"><td class="memItemLeft" align="right" valign="top">static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0">query</a> (const char *qry, int nargs, Oid *argtypes, Datum *args, bool read_only, void **saved_plan, <a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274">Fetch_fn</a> process_row, void *fn_param)</td></tr>
<tr class="memdesc:a44d4a5e2cad01992bcc04ef319d1fef0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare and execute a query.  <a href="#a44d4a5e2cad01992bcc04ef319d1fef0">More...</a><br /></td></tr>
<tr class="separator:a44d4a5e2cad01992bcc04ef319d1fef0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af74e06c2774ec139f2d4b9b01cfb7409"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#af74e06c2774ec139f2d4b9b01cfb7409">fetch_one_bool</a> (HeapTuple tuple, TupleDesc tupdesc, void *p_result)</td></tr>
<tr class="memdesc:af74e06c2774ec139f2d4b9b01cfb7409"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274" title="A Fetch_fn is a function that processes records, one at a time, returned from a query. ">Fetch_fn</a> function for processing a single row of a single integer for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a>.  <a href="#af74e06c2774ec139f2d4b9b01cfb7409">More...</a><br /></td></tr>
<tr class="separator:af74e06c2774ec139f2d4b9b01cfb7409"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a29733ffa995028a351ebd9b6174a4333"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a29733ffa995028a351ebd9b6174a4333">fetch_one_str</a> (HeapTuple tuple, TupleDesc tupdesc, void *p_result)</td></tr>
<tr class="memdesc:a29733ffa995028a351ebd9b6174a4333"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274" title="A Fetch_fn is a function that processes records, one at a time, returned from a query. ">Fetch_fn</a> function for processing a single row of a single integer for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a>.  <a href="#a29733ffa995028a351ebd9b6174a4333">More...</a><br /></td></tr>
<tr class="separator:a29733ffa995028a351ebd9b6174a4333"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e2d2bd134994c5fb78e4f0a875f97d8"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a8e2d2bd134994c5fb78e4f0a875f97d8">vl_bool_from_query</a> (const char *qry, bool *result)</td></tr>
<tr class="memdesc:a8e2d2bd134994c5fb78e4f0a875f97d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a query that returns a single bool value.  <a href="#a8e2d2bd134994c5fb78e4f0a875f97d8">More...</a><br /></td></tr>
<tr class="separator:a8e2d2bd134994c5fb78e4f0a875f97d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adae474c43e4cad08e5b279877c4658a6"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#adae474c43e4cad08e5b279877c4658a6">str_from_oid_query</a> (const char *qry, const Oid param, char *result)</td></tr>
<tr class="memdesc:adae474c43e4cad08e5b279877c4658a6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Executes a query by oid, that returns a single string value.  <a href="#adae474c43e4cad08e5b279877c4658a6">More...</a><br /></td></tr>
<tr class="separator:adae474c43e4cad08e5b279877c4658a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e0343be498d7eedd451d4e4cd8e2a84"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a3e0343be498d7eedd451d4e4cd8e2a84">vl_db_exists</a> (Oid db_id)</td></tr>
<tr class="memdesc:a3e0343be498d7eedd451d4e4cd8e2a84"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determine whether the given oid represents an existing database or not.  <a href="#a3e0343be498d7eedd451d4e4cd8e2a84">More...</a><br /></td></tr>
<tr class="separator:a3e0343be498d7eedd451d4e4cd8e2a84"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf73907c6d5d14adcb3d4a82f59443a7"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#aaf73907c6d5d14adcb3d4a82f59443a7">exec_init_fn</a> (HeapTuple tuple, TupleDesc tupdesc, void *p_param)</td></tr>
<tr class="memdesc:aaf73907c6d5d14adcb3d4a82f59443a7"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274" title="A Fetch_fn is a function that processes records, one at a time, returned from a query. ">Fetch_fn</a> function for executing registered <a class="el" href="veil__funcs_8h.html#a1eb95ff8b9c26ea5494f61dde6f9c31b" title="veil_init(doing_reset bool) returns bool Initialise or reset a veil session. ">veil_init()</a> functions for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a>.  <a href="#aaf73907c6d5d14adcb3d4a82f59443a7">More...</a><br /></td></tr>
<tr class="separator:aaf73907c6d5d14adcb3d4a82f59443a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a82e58c1dcee9434fb3f15cf08aa9217f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="veil__query_8c.html#a82e58c1dcee9434fb3f15cf08aa9217f">vl_call_init_fns</a> (bool param)</td></tr>
<tr class="memdesc:a82e58c1dcee9434fb3f15cf08aa9217f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Identify any registered init_functions and execute them.  <a href="#a82e58c1dcee9434fb3f15cf08aa9217f">More...</a><br /></td></tr>
<tr class="separator:a82e58c1dcee9434fb3f15cf08aa9217f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Functions to simplify SPI-based queries. These are way more sophisticated than veil really needs but are nice and generic. </p>
<div class="fragment"><div class="line">Author:       Marc Munro</div><div class="line">Copyright (c) 2005 - 2011 Marc Munro</div><div class="line">License:      BSD</div></div><!-- fragment --> 
<p class="definition">Definition in file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a96037051f6607912be91e02a1a7326e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a96037051f6607912be91e02a1a7326e1">&#9670;&nbsp;</a></span>vl_spi_connect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vl_spi_connect </td>
          <td>(</td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>p_pushed</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>If already connected in this session, push the current connection, and get a new one. </p>
<p>We are already connected, if:</p><ul>
<li>are within a query</li>
<li>and the current transaction id matches the saved transaction id </li>
</ul>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00046">46</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__interface_8c_source.html#l00145">ensure_init()</a>, <a class="el" href="veil__query_8c_source.html#l00294">exec_init_fn()</a>, <a class="el" href="veil__interface_8c_source.html#l02364">veil_perform_reset()</a>, and <a class="el" href="veil__query_8c_source.html#l00336">vl_call_init_fns()</a>.</p>

</div>
</div>
<a id="a149deb729a4822a1d84ce21fba1fdf04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a149deb729a4822a1d84ce21fba1fdf04">&#9670;&nbsp;</a></span>prepare_query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void prepare_query </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>qry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Oid *&#160;</td>
          <td class="paramname"><em>argtypes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Datum *&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>read_only</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>saved_plan</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prepare a query for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query()</a>. </p>
<p>This creates and executes a plan. The caller must have established SPI_connect. It is assumed that no parameters to the query will be null. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qry</td><td>The text of the SQL query to be performed. </td></tr>
    <tr><td class="paramname">nargs</td><td>The number of input parameters ($1, $2, etc) to the query </td></tr>
    <tr><td class="paramname">argtypes</td><td>Pointer to an array containing the OIDs of the data </td></tr>
    <tr><td class="paramname">args</td><td>Actual parameters types of the parameters </td></tr>
    <tr><td class="paramname">read_only</td><td>Whether the query should be read-only or not </td></tr>
    <tr><td class="paramname">saved_plan</td><td>Adress of void pointer into which the query plan will be saved. Passing the same void pointer on a subsequent call will cause the saved query plan to be re-used. </td></tr>
  </table>
  </dd>
</dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00086">86</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__query_8c_source.html#l00151">query()</a>.</p>

</div>
</div>
<a id="a44d4a5e2cad01992bcc04ef319d1fef0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a44d4a5e2cad01992bcc04ef319d1fef0">&#9670;&nbsp;</a></span>query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static int query </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>qry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nargs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Oid *&#160;</td>
          <td class="paramname"><em>argtypes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Datum *&#160;</td>
          <td class="paramname"><em>args</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>read_only</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>saved_plan</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274">Fetch_fn</a>&#160;</td>
          <td class="paramname"><em>process_row</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fn_param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Prepare and execute a query. </p>
<p>Query execution consists of a call to process_row for each returned record. Process_row can return a single value to the caller of this function through the fn_param parameter. It is the caller's responsibility to establish an SPI connection with SPI_connect. It is assumed that no parameters to the query, and no results will be null. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qry</td><td>The text of the SQL query to be performed. </td></tr>
    <tr><td class="paramname">nargs</td><td>The number of input parameters ($1, $2, etc) to the query </td></tr>
    <tr><td class="paramname">argtypes</td><td>Pointer to an array containing the OIDs of the data </td></tr>
    <tr><td class="paramname">args</td><td>Actual parameters types of the parameters </td></tr>
    <tr><td class="paramname">read_only</td><td>Whether the query should be read-only or not </td></tr>
    <tr><td class="paramname">saved_plan</td><td>Adress of void pointer into which the query plan will be saved. Passing the same void pointer on a subsequent call will cause the saved query plan to be re-used. </td></tr>
    <tr><td class="paramname">process_row</td><td>The <a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274" title="A Fetch_fn is a function that processes records, one at a time, returned from a query. ">Fetch_fn</a> function to be called for each fetched row to process it. If this is null, we simply count the row, doing no processing on the tuples returned. </td></tr>
    <tr><td class="paramname">fn_param</td><td>An optional parameter to the process_row function. This may be used to return a value to the caller. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The total number of records fetched and processed by process_row. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00151">151</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">References <a class="el" href="veil__query_8c_source.html#l00086">prepare_query()</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__query_8c_source.html#l00253">str_from_oid_query()</a>, <a class="el" href="veil__query_8c_source.html#l00232">vl_bool_from_query()</a>, and <a class="el" href="veil__query_8c_source.html#l00336">vl_call_init_fns()</a>.</p>

</div>
</div>
<a id="af74e06c2774ec139f2d4b9b01cfb7409"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af74e06c2774ec139f2d4b9b01cfb7409">&#9670;&nbsp;</a></span>fetch_one_bool()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool fetch_one_bool </td>
          <td>(</td>
          <td class="paramtype">HeapTuple&#160;</td>
          <td class="paramname"><em>tuple</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TupleDesc&#160;</td>
          <td class="paramname"><em>tupdesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274" title="A Fetch_fn is a function that processes records, one at a time, returned from a query. ">Fetch_fn</a> function for processing a single row of a single integer for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tuple</td><td>The row to be processed </td></tr>
    <tr><td class="paramname">tupdesc</td><td>Descriptor for the types of the fields in the tuple. </td></tr>
    <tr><td class="paramname">p_result</td><td>Pointer to an int4 variable into which the value returned from the query will be placed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>false. This causes <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a> to terminate after processing a single row. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00194">194</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__query_8c_source.html#l00232">vl_bool_from_query()</a>.</p>

</div>
</div>
<a id="a29733ffa995028a351ebd9b6174a4333"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a29733ffa995028a351ebd9b6174a4333">&#9670;&nbsp;</a></span>fetch_one_str()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool fetch_one_str </td>
          <td>(</td>
          <td class="paramtype">HeapTuple&#160;</td>
          <td class="paramname"><em>tuple</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TupleDesc&#160;</td>
          <td class="paramname"><em>tupdesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274" title="A Fetch_fn is a function that processes records, one at a time, returned from a query. ">Fetch_fn</a> function for processing a single row of a single integer for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tuple</td><td>The row to be processed </td></tr>
    <tr><td class="paramname">tupdesc</td><td>Descriptor for the types of the fields in the tuple. </td></tr>
    <tr><td class="paramname">p_result</td><td>Pointer to an int4 variable into which the value returned from the query will be placed. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>false. This causes <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a> to terminate after processing a single row. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00214">214</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__query_8c_source.html#l00253">str_from_oid_query()</a>.</p>

</div>
</div>
<a id="a8e2d2bd134994c5fb78e4f0a875f97d8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e2d2bd134994c5fb78e4f0a875f97d8">&#9670;&nbsp;</a></span>vl_bool_from_query()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vl_bool_from_query </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>qry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Executes a query that returns a single bool value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qry</td><td>The text of the query to be performed. </td></tr>
    <tr><td class="paramname">result</td><td>Variable into which the result of the query will be placed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the query returned a record, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00232">232</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">References <a class="el" href="veil__query_8c_source.html#l00194">fetch_one_bool()</a>, and <a class="el" href="veil__query_8c_source.html#l00151">query()</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__interface_8c_source.html#l00145">ensure_init()</a>, <a class="el" href="veil__query_8c_source.html#l00294">exec_init_fn()</a>, and <a class="el" href="veil__interface_8c_source.html#l02364">veil_perform_reset()</a>.</p>

</div>
</div>
<a id="adae474c43e4cad08e5b279877c4658a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adae474c43e4cad08e5b279877c4658a6">&#9670;&nbsp;</a></span>str_from_oid_query()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool str_from_oid_query </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>qry</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Oid&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&#160;</td>
          <td class="paramname"><em>result</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Executes a query by oid, that returns a single string value. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">qry</td><td>The text of the query to be performed. </td></tr>
    <tr><td class="paramname">param</td><td>The oid of the row to be fetched. </td></tr>
    <tr><td class="paramname">result</td><td>Variable into which the result of the query will be placed.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true if the query returned a record, false otherwise. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00253">253</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">References <a class="el" href="veil__query_8c_source.html#l00214">fetch_one_str()</a>, and <a class="el" href="veil__query_8c_source.html#l00151">query()</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__query_8c_source.html#l00275">vl_db_exists()</a>.</p>

</div>
</div>
<a id="a3e0343be498d7eedd451d4e4cd8e2a84"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e0343be498d7eedd451d4e4cd8e2a84">&#9670;&nbsp;</a></span>vl_db_exists()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool vl_db_exists </td>
          <td>(</td>
          <td class="paramtype">Oid&#160;</td>
          <td class="paramname"><em>db_id</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Determine whether the given oid represents an existing database or not. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">db_id</td><td>Oid of the database in which we are interested.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>True if the database exists. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00275">275</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">References <a class="el" href="veil__query_8c_source.html#l00253">str_from_oid_query()</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__shmem_8c_source.html#l00240">get_shmem_context()</a>.</p>

</div>
</div>
<a id="aaf73907c6d5d14adcb3d4a82f59443a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaf73907c6d5d14adcb3d4a82f59443a7">&#9670;&nbsp;</a></span>exec_init_fn()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool exec_init_fn </td>
          <td>(</td>
          <td class="paramtype">HeapTuple&#160;</td>
          <td class="paramname"><em>tuple</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">TupleDesc&#160;</td>
          <td class="paramname"><em>tupdesc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>p_param</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p><a class="el" href="veil__query_8c.html#a42368367f5a1eef750ff948f44890274" title="A Fetch_fn is a function that processes records, one at a time, returned from a query. ">Fetch_fn</a> function for executing registered <a class="el" href="veil__funcs_8h.html#a1eb95ff8b9c26ea5494f61dde6f9c31b" title="veil_init(doing_reset bool) returns bool Initialise or reset a veil session. ">veil_init()</a> functions for <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tuple</td><td>The row to be processed </td></tr>
    <tr><td class="paramname">tupdesc</td><td>Descriptor for the types of the fields in the tuple. </td></tr>
    <tr><td class="paramname">p_param</td><td>Pointer to a boolean value which is the value of the argument to the init function being called. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>true. This allows <a class="el" href="veil__query_8c.html#a44d4a5e2cad01992bcc04ef319d1fef0" title="Prepare and execute a query. ">query</a> to process further rows. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00294">294</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">References <a class="el" href="veil__query_8c_source.html#l00232">vl_bool_from_query()</a>, <a class="el" href="veil__query_8c_source.html#l00046">vl_spi_connect()</a>, and <a class="el" href="veil__query_8c_source.html#l00062">vl_spi_finish()</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__query_8c_source.html#l00336">vl_call_init_fns()</a>.</p>

</div>
</div>
<a id="a82e58c1dcee9434fb3f15cf08aa9217f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a82e58c1dcee9434fb3f15cf08aa9217f">&#9670;&nbsp;</a></span>vl_call_init_fns()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int vl_call_init_fns </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Identify any registered init_functions and execute them. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">param</td><td>The boolean parameter to be passed to each init_function.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The number of init_functions executed. </dd></dl>

<p class="definition">Definition at line <a class="el" href="veil__query_8c_source.html#l00336">336</a> of file <a class="el" href="veil__query_8c_source.html">veil_query.c</a>.</p>

<p class="reference">References <a class="el" href="veil__query_8c_source.html#l00294">exec_init_fn()</a>, <a class="el" href="veil__query_8c_source.html#l00151">query()</a>, <a class="el" href="veil__query_8c_source.html#l00046">vl_spi_connect()</a>, and <a class="el" href="veil__query_8c_source.html#l00062">vl_spi_finish()</a>.</p>

<p class="reference">Referenced by <a class="el" href="veil__interface_8c_source.html#l02334">veil_init()</a>.</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="veil__query_8c.html">veil_query.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
