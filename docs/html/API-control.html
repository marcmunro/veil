<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Veil: Veil Control Functions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Veil
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',false,false,'search.php','Search');
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('API-control.html','');});
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<div class="title">Veil Control Functions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Veil generally requires no management. The exception to this is when you wish to reset shared variables. You may wish to do this because your underlying security definitions have changed, or because you have added new features. In this case, you may use <a class="el" href="veil__funcs_8h.html#aba68f965e211edd6b2f06591e0fc1ef6" title="veil_perform_reset() returns bool Reset veil shared memory for this database. ">veil_perform_reset()</a> to re-initialise your shared variables. This function replaces the current set of shared variables with a new set in a transaction-safe manner. All current transactions will complete with the old set of variables in place. All subsequent transactions will see the new set.</p>
<p>The following functions comprise the Veil control functions API:</p>
<ul>
<li><code><a class="el" href="API-control.html#API-control-registered-init">registered initialisation functions</a></code></li>
<li><code><a class="el" href="API-control.html#API-control-init">veil_init(doing_reset bool)</a></code></li>
<li><code><a class="el" href="API-control.html#API-control-reset">veil_perform_reset()</a></code></li>
<li><code><a class="el" href="API-control.html#API-version">version()</a></code></li>
</ul>
<h1><a class="anchor" id="API-control-registered-init"></a>
registered initialisation functions</h1>
<p>A registered initialisation function is one which will be called from the standard veil <a class="el" href="API-control.html#API-control-init">veil_init(doing_reset bool)</a> function. Such functions are responsible for defining and, usually, initialising shared variables.</p>
<p>Initialisation functions may be written in any language supported by PostgreSQL, and must conform to the following function prototype:</p>
<pre class="fragment">function init_function(doing_reset bool) returns bool
</pre><p>The <code>doing_reset</code> parameter will be set to true if we are completely resetting veil and redefining all of its variables. In this case, we must declare and, probably, initialise shared variables prior to any session initialisation actions. The parameter will be false, if the function is solely being called to initialise a new session. Check <a class="el" href="Demo.html#demo-sec">The Veil Demo Application</a> for an example.</p>
<p>Initialisation functions are registered by inserting their name into the configuration table <code>veil.veil_init_fns</code>. The functions listed in this table are executed in order of the <code>priority</code> column. Eg, to register <code>veil.init_roles()</code> to execute before <code>veil.init_role_privs()</code>, we would use the following insert statement:</p>
<pre class="fragment">insert into veil.veil_init_fns
       (fn_name, priority)
values ('veil.init_roles', 1),
       ('veil.init_role_privs', 2);
</pre><h1><a class="anchor" id="API-control-init"></a>
veil_init(doing_reset bool)</h1>
<pre class="fragment">function veil.veil_init(doing_reset bool) returns bool
</pre><p>This function, implemented by the C function <a class="el" href="veil__funcs_8h.html#a1eb95ff8b9c26ea5494f61dde6f9c31b" title="veil_init(doing_reset bool) returns bool Initialise or reset a veil session. ">veil_init()</a>, is reponsible for initialising each veil session. The <code>doing_reset</code> parameter is true if we are to completely reset Veil, redefining all shared variables.</p>
<p>The builtin implementation of <a class="el" href="veil__funcs_8h.html#a1eb95ff8b9c26ea5494f61dde6f9c31b" title="veil_init(doing_reset bool) returns bool Initialise or reset a veil session. ">veil_init()</a> will call each registered initialisation function (see <a class="el" href="API-control.html#API-control-registered-init">registered initialisation functions</a>) in turn.</p>
<p>If no initialisation functions are registered, <a class="el" href="veil__funcs_8h.html#a1eb95ff8b9c26ea5494f61dde6f9c31b" title="veil_init(doing_reset bool) returns bool Initialise or reset a veil session. ">veil_init()</a> raises an exception.</p>
<p>As an alternative to registering initialisation functions, a Veil-based application may instead simply redefine veil.veil_init(), though this usage is deprecated.</p>
<h1><a class="anchor" id="API-control-reset"></a>
veil_perform_reset()</h1>
<pre class="fragment">function veil.veil_perform_reset() returns bool
</pre><p> This is used to reset Veil's shared variables. It causes <a class="el" href="API-control.html#API-control-init">veil_init(doing_reset bool)</a> to be called. Implemented by C function <a class="el" href="veil__funcs_8h.html#aba68f965e211edd6b2f06591e0fc1ef6" title="veil_perform_reset() returns bool Reset veil shared memory for this database. ">veil_perform_reset()</a>.</p>
<h1><a class="anchor" id="API-version"></a>
version()</h1>
<pre class="fragment">function veil.version() returns text
</pre><p> This function returns a string describing the installed version of veil. Implemented by C function <a class="el" href="veil__funcs_8h.html#a2576302e0f6d314d71d029476253610c" title="veil_version() returns text Return a string describing this version of veil. ">veil_version()</a>.</p>
<p>Next: <a class="el" href="Building.html">Building a Veil-based secure database</a> </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Veil</a></li><li class="navelem"><a class="el" href="API-page.html">The Veil API</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
